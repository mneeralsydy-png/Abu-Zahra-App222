<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #0F172A; color: #fff; overflow: hidden; }
        .screen { display: none; position: fixed; inset: 0; flex-direction: column; }
        .screen.active { display: flex; }
        .golden-text-title { font-family: 'Amiri', serif; background: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* تأثيرات */
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .social-btn { transition: all 0.2s; }
        .social-btn:active { transform: scale(0.98); }
    </style>
</head>
<body>

    <!-- === 1. شاشة الترحيب (Splash) === -->
    <div id="screen-splash" class="screen active items-center justify-center bg-[#0F172A]">
        <div class="text-center">
            <h1 class="text-6xl golden-text-title">Abu Al-Zahra</h1>
            <p class="text-blue-300 text-sm tracking-widest mt-4">PARENTAL CONTROL SYSTEM</p>
            <div class="mt-8 w-10 h-10 border-4 border-blue-500 border-dashed rounded-full animate-spin mx-auto"></div>
            <p id="splash-status" class="text-gray-500 text-xs mt-4">جاري التحميل...</p>
        </div>
    </div>

    <!-- === 2. شاشة تسجيل الدخول (Login) - التصميم المطلوب === -->
    <div id="screen-login" class="screen items-center justify-center bg-[#0F172A] p-6">
        <div class="w-full max-w-sm text-center space-y-6">
            
            <!-- الشعار والعنوان -->
            <div class="mb-8">
                <h2 class="text-5xl golden-text-title">مرحباً</h2>
                <p class="text-blue-200 text-sm mt-2">سجل الدخول للمتابعة</p>
            </div>
            
            <!-- صندوق الدخول -->
            <div class="glass-panel rounded-3xl p-6 space-y-4 shadow-2xl border border-slate-700">
                
                <!-- حقل البريد -->
                <div class="text-right">
                    <label class="text-blue-200 text-xs block mb-1">البريد الإلكتروني</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m0 0a9 9 0 109-9m0 0v2.5m3.5-6.5a9 9 0 00-12.5 0" /></svg>
                        </div>
                        <input id="txt-email" type="email" class="w-full bg-white/5 border border-white/10 text-white rounded-xl px-4 py-3 pr-10 focus:outline-none focus:border-blue-400 text-sm" placeholder="example@email.com">
                    </div>
                </div>

                <!-- حقل كلمة المرور -->
                <div class="text-right">
                    <label class="text-blue-200 text-xs block mb-1">كلمة المرور</label>
                     <div class="relative">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                        </div>
                        <input id="txt-pass" type="password" class="w-full bg-white/5 border border-white/10 text-white rounded-xl px-4 py-3 pr-10 focus:outline-none focus:border-blue-400 text-sm" placeholder="********">
                    </div>
                </div>

                <!-- رابط نسيت كلمة المرور -->
                <div class="text-left">
                    <a href="#" onclick="showToast('ميزة قيد التطوير')" class="text-blue-400 text-xs hover:underline">نسيت كلمة المرور؟</a>
                </div>

                <!-- زر تسجيل الدخول -->
                <button onclick="handleLogin()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-blue-500 transition">تسجيل الدخول</button>
                
                <!-- فاصل -->
                <div class="flex items-center gap-2 text-blue-300 text-xs">
                    <div class="flex-1 h-[1px] bg-white/20"></div><span>أو</span><div class="flex-1 h-[1px] bg-white/20"></div>
                </div>
                
                <!-- زر جوجل -->
                <button onclick="handleGoogleLogin()" class="social-btn w-full bg-white text-gray-800 py-3 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span>الدخول بجوجل</span>
                </button>

                <!-- زر إنشاء حساب -->
                <button onclick="handleRegister()" class="social-btn w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-green-500 transition mt-2">إنشاء حساب جديد</button>
                
                <p id="auth-error" class="text-red-400 text-xs mt-2 hidden"></p>
            </div>
            
            <!-- الشروط -->
            <p class="text-gray-500 text-xs px-4">
                بالمتابعة، أنت توافق على <a href="#" class="text-blue-400 hover:underline">شروط الخدمة</a> وتقر بقراءة <a href="#" class="text-blue-400 hover:underline">سياسة الخصوصية</a>.
            </p>
        </div>
    </div>

    <!-- === 3. شاشة الربط (Binding) === -->
    <div id="screen-binding" class="screen items-center justify-center bg-[#0F172A] p-6">
        <div class="text-center w-full max-w-sm">
            <div class="w-20 h-20 mx-auto bg-green-500/20 rounded-full flex items-center justify-center mb-4">
                <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" /></svg>
            </div>
            <h2 class="text-2xl text-white font-bold mb-2">ربط جهاز جديد</h2>
            <p class="text-gray-400 text-sm mb-6">أدخل هذا الكود في تطبيق الطفل</p>
            <div class="bg-slate-800 border-2 border-dashed border-green-500 rounded-xl p-4 mb-6">
                <p id="display-code" class="text-4xl font-mono text-white font-bold">000 000 000</p>
            </div>
            <p id="bind-status" class="text-xs text-gray-500">في انتظار اتصال جهاز الطفل...</p>
        </div>
    </div>

    <!-- === 4. لوحة التحكم (Dashboard) === -->
    <div id="screen-main" class="screen bg-[#0F172A]">
        <header class="bg-slate-900/80 border-b border-slate-700 px-4 py-3 flex justify-between items-center shrink-0 z-20">
            <h1 class="text-lg font-bold text-white">Abu <span class="golden-text-title">Al-Zahra</span></h1>
            <span class="text-xs text-green-400 bg-green-500/10 px-2 py-1 rounded-full">متصل</span>
        </header>
        <main class="p-4 flex-1 overflow-y-auto">
            <div class="bg-slate-800 p-6 rounded-xl text-white text-center">
                <h3 class="text-xl font-bold mb-2">لوحة التحكم</h3>
                <p class="text-gray-400 text-sm">جاري تحميل البيانات...</p>
            </div>
        </main>
    </div>

    <!-- ==================== JavaScript Logic ==================== -->
    <script>
        // === إدارة الشاشات ===
        function showScreen(id){ 
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); 
            document.getElementById(id).classList.add('active'); 
        }

        function callNative(fn, arg){ 
            try {
                if(typeof AndroidNative !== 'undefined'){ 
                    arg ? AndroidNative[fn](arg) : AndroidNative[fn](); 
                } else {
                    console.warn(`Native bridge (${fn}) not found.`);
                }
            } catch(e) {
                console.error("Native call failed", e);
            }
        }
        
        // === Logic ===
        
        function handleLogin(){ 
            const email = document.getElementById('txt-email').value;
            const pass = document.getElementById('txt-pass').value;
            if(!email || !pass) return;
            callNative('loginUser', JSON.stringify({email: email, pass: pass})); 
        }

        function handleRegister(){ 
            const email = document.getElementById('txt-email').value;
            const pass = document.getElementById('txt-pass').value;
            if(!email || !pass) return;
            callNative('registerUser', JSON.stringify({email: email, pass: pass})); 
        }
        
        function handleGoogleLogin(){ 
            callNative('loginWithGoogle'); 
        }

        // === Callbacks (يستدعيها Kotlin) ===
        
        window.onAuthSuccess = function(uid){ 
            showScreen('screen-binding'); 
            const c = Math.floor(100000000 + Math.random() * 900000000).toString(); 
            document.getElementById('display-code').innerText = c.substring(0,3) + " " + c.substring(3,6) + " " + c.substring(6); 
            callNative('startListeningForChild', c.replace(/\s/g, '')); 
        };

        window.onAuthError = function(msg){ 
            document.getElementById('auth-error').innerText = msg; 
            document.getElementById('auth-error').classList.remove('hidden'); 
        };

        window.onChildLinked = function(){ 
            showScreen('screen-main'); 
        };

        window.showLoginScreen = function(){ 
            showScreen('screen-login'); 
        };
        
        window.showToast = function(msg){ alert(msg); }

        // === حل مشكلة التعليق: Safety Timeout ===
        // إذا لم يستجب التطبيق خلال 4 ثواني، انتقل لشاشة الدخول
        setTimeout(function(){
            if(document.getElementById('screen-splash').classList.contains('active')){
                console.log("Safety Timeout: Force showing login.");
                showScreen('screen-login');
            }
        }, 4000);

        // بدء التشغيل
        setTimeout(function(){ callNative('checkUserStatus'); }, 500);

    </script>
</body>
</html>
