<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">
    <style>
        body{font-family:'Tajawal',sans-serif;background-color:#FFFFFF;color:#202124}
        .screen{display:none;position:fixed;inset:0;flex-direction:column}
        .screen.active{display:flex}
        .input-field{width:100%;padding:12px 16px;border:1px solid #dadce0;border-radius:8px;outline:none;font-size:16px;margin-bottom:12px}
        .input-field:focus{border-color:#1a73e8}
        .btn-primary{width:100%;background-color:#1a73e8;color:white;padding:12px;border-radius:8px;font-weight:bold;border:none;font-size:16px}
        .btn-secondary{width:100%;background-color:white;color:#3c4043;padding:10px;border:1px solid #dadce0;border-radius:8px;font-weight:500;display:flex;align-items:center;justify-content:center;gap:8px}
        .code-box{font-family:'Roboto',monospace;font-size:32px;letter-spacing:4px;background:#f1f3f4;padding:20px;border-radius:12px;color:#202124}
    </style>
</head>
<body>

    <!-- 1. Splash Screen -->
    <div id="screen-splash" class="screen active items-center justify-center bg-white">
        <div class="text-center">
            <h1 class="text-4xl text-blue-600 font-bold mb-2">Abu Al-Zahra</h1>
            <div class="mt-4 w-6 h-6 border-2 border-blue-600 border-dashed rounded-full animate-spin mx-auto"></div>
        </div>
    </div>

    <!-- 2. Login Screen -->
    <div id="screen-login" class="screen items-center justify-center bg-white p-6">
        <div class="w-full max-w-sm">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <p class="text-gray-500 text-sm mt-1">Ø§Ø³ØªØ®Ø¯Ù… Ø­Ø³Ø§Ø¨Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
            </div>

            <div class="space-y-3">
                <input id="txt-email" type="email" class="input-field" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                <input id="txt-pass" type="password" class="input-field" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                
                <button onclick="handleLogin()" class="btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                
                <div class="text-center text-gray-400 text-xs my-2">Ø£Ùˆ</div>
                
                <button onclick="handleGoogleLogin()" class="btn-secondary">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/></svg>
                    <span style="font-family:'Roboto',sans-serif">Sign in with Google</span>
                </button>
            </div>

            <p id="auth-error" class="text-red-500 text-xs text-center mt-4 hidden"></p>
            
            <div class="text-center mt-6">
                <span class="text-gray-600 text-sm">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span>
                <button onclick="handleRegister()" class="text-blue-600 font-bold text-sm mr-1">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
            </div>
        </div>
    </div>

    <!-- 3. Binding Screen -->
    <div id="screen-binding" class="screen items-center justify-center bg-white p-6">
        <div class="w-full max-w-sm text-center">
            <div class="w-16 h-16 bg-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                <span class="text-3xl">ğŸ”—</span>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">Ø±Ù…Ø² Ø§Ù„Ø±Ø¨Ø·</h2>
            <p class="text-gray-500 text-sm mb-6">Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø®Ø§Øµ Ø¨Ø­Ø³Ø§Ø¨Ùƒ ÙˆÙŠØ¨Ù‚Ù‰ Ø«Ø§Ø¨ØªØ§Ù‹. Ø§Ø¯Ø®Ù„Ù‡ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·ÙÙ„.</p>
            
            <div class="code-box mb-4" id="display-code">---</div>
            
            <p class="text-gray-400 text-xs mt-4">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§ØªØµØ§Ù„ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø·ÙÙ„...</p>
        </div>
    </div>
    
    <!-- 4. Success Screen (Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø´Ø§Ø´Ø© Ù†Ø¬Ø§Ø­ Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø²Ø±ÙŠÙ†) -->
    <div id="screen-success" class="screen items-center justify-center bg-white p-6">
        <div class="w-full max-w-sm text-center">
            <div class="w-24 h-24 bg-green-100 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg">
                <svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!</h2>
            <p class="text-gray-500 text-sm mb-8">ØªÙ… ØªÙˆØµÙŠÙ„ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø·ÙÙ„ Ø¨Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©.</p>
            
            <div class="space-y-3">
                <button onclick="goToDashboard()" class="btn-primary">ØªÙ…</button>
                <button onclick="addAnotherDevice()" class="btn-secondary text-blue-600 border-blue-100">Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±</button>
            </div>
        </div>
    </div>

    <!-- 5. Dashboard -->
    <div id="screen-main" class="screen bg-gray-100">
        <header class="bg-white p-4 border-b shadow-sm flex justify-between items-center shrink-0 z-20">
            <h1 class="text-lg font-bold text-gray-800">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <span class="text-xs text-green-600 font-bold">Online</span>
        </header>
        <main class="p-4 flex-1 overflow-y-auto">
            <div class="bg-white p-4 rounded-xl shadow-sm mb-4">
                <h3 class="font-bold text-gray-800">Ø¬Ù‡Ø§Ø² Ø§Ù„Ø·ÙÙ„</h3>
                <p class="text-sm text-gray-500">Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: <span id="txt-battery">--</span>%</p>
            </div>
        </main>
    </div>

    <script>
        function callNative(fn, arg){ if(typeof AndroidNative!=='undefined'){ arg ? AndroidNative[fn](arg) : AndroidNative[fn](); } }
        function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

        function handleLogin(){
            const e = document.getElementById('txt-email').value;
            const p = document.getElementById('txt-pass').value;
            if(!e || !p) return;
            callNative('loginUser', JSON.stringify({email:e, pass:p}));
        }

        function handleRegister(){
            const e = document.getElementById('txt-email').value;
            const p = document.getElementById('txt-pass').value;
            if(!e || !p) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ³Ø¬ÙŠÙ„"); return; }
            callNative('registerUser', JSON.stringify({email:e, pass:p}));
        }

        function handleGoogleLogin(){
            callNative('loginGoogle');
        }

        // Callbacks from Native
        window.onAuthSuccess = function(uid){ showScreen('screen-binding'); }
        
        window.onGoogleLoginSuccess = function(){
            // Success handled by checkUserStatus usually
        }

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„ÙƒÙˆØªÙ„Ù† (Ø«Ø§Ø¨Øª Ø£Ùˆ Ø¬Ø¯ÙŠØ¯)
        window.showBindingCode = function(code){
            const formatted = code.substring(0,3) + " " + code.substring(3,6) + " " + code.substring(6);
            document.getElementById('display-code').innerText = formatted;
            showScreen('screen-binding');
            // Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø·ÙÙ„
            callNative('startListeningForChild', code);
        };
        
        // Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø·ÙÙ„ -> Ù†Ø°Ù‡Ø¨ Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        window.onChildLinked = function(){
            showScreen('screen-success');
        };
        
        // Ø²Ø± "ØªÙ…" -> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function goToDashboard(){
            showScreen('screen-main');
        }
        
        // Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±" -> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¨Ø· (Ø³ÙŠØ¸Ù‡Ø± Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø«Ø§Ø¨Øª)
        function addAnotherDevice(){
            showScreen('screen-binding');
        }

        window.onAuthError = function(msg){ 
            document.getElementById('auth-error').innerText = msg; 
            document.getElementById('auth-error').classList.remove('hidden'); 
        };
        
        window.updateChildData = function(json){
            const data = JSON.parse(json);
            document.getElementById('txt-battery').innerText = data.battery;
        }

        // Start
        setTimeout(function(){ callNative('checkUserStatus'); }, 500);
    </script>
</body>
                                                                                                              </html>
