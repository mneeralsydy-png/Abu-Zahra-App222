<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Abu Al-Zahra Parental Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #0F172A; overflow: hidden; }
        .card-dark { background-color: #1E293B; border: 1px solid rgba(255, 255, 255, 0.05); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .glass-panel { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(8px); z-index: 50; display: none; align-items: center; justify-content: center; }
        .modal-content { background-color: #1E293B; width: 95%; height: 90%; max-width: 500px; border-radius: 20px; padding: 0; animation: fadeUp 0.3s ease-out; border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; overflow: hidden; }
        .modal-header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; overflow-y: auto; flex: 1; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shine { to { background-position: 200% center; } }
        .golden-text-title { font-family: 'Amiri', serif; background: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shine 4s linear infinite; }
        .splash-bg { background: linear-gradient(-45deg, #0f172a, #1e293b, #0f172a, #172554); background-size: 400% 400%; animation: gradientBG 15s ease infinite; }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-track { background: #1E293B; } ::-webkit-scrollbar-thumb { background: #475569; border-radius: 2px; }
        .perm-btn { transition: all 0.2s; }
        .perm-btn.active { background-color: #10B981; border-color: #10B981; }
    </style>
</head>
<body class="text-gray-200">

    <!-- 1. شاشة الترحيب -->
    <div id="screen-splash" class="fixed inset-0 z-50 flex flex-col items-center justify-center splash-bg">
        <div class="absolute w-[600px] h-[600px] bg-blue-900 rounded-full filter blur-3xl opacity-20 animate-pulse"></div>
        <div class="relative z-10 text-center fade-in">
            <h1 class="text-8xl golden-text-title mb-4">Abu Al-Zahra</h1>
            <p class="text-blue-300 text-lg tracking-widest uppercase mt-2 opacity-80">Parental Control System</p>
            <div class="mt-8">
                <div class="w-8 h-8 border-4 border-blue-500 border-dashed rounded-full animate-spin mx-auto"></div>
                <p class="text-gray-500 text-xs mt-2">جاري التحميل...</p>
            </div>
        </div>
    </div>

    <!-- 2. شاشة تسجيل الدخول / إنشاء الحساب -->
    <div id="screen-login" class="fixed inset-0 z-40 hidden flex-col items-center justify-center bg-[#0F172A] p-6">
        <div class="w-full max-w-sm text-center space-y-6">
            <div class="mb-8">
                <h2 class="text-5xl golden-text-title">Abu Al-Zahra</h2>
                <p id="auth-subtitle" class="text-blue-200 text-sm mt-2">تسجيل الدخول للمتابعة</p>
            </div>
            <div class="glass-panel rounded-3xl p-6 space-y-4 border border-white/10 shadow-2xl">
                <div class="space-y-3 text-right">
                    <div>
                        <label class="text-blue-200 text-xs block mb-1">البريد الإلكتروني</label>
                        <input id="email-input" type="email" class="w-full bg-white/5 border border-white/20 text-white rounded-xl px-4 py-3 focus:outline-none focus:border-blue-400 text-sm" placeholder="example@email.com">
                    </div>
                    <div>
                        <label class="text-blue-200 text-xs block mb-1">كلمة المرور</label>
                        <input id="pass-input" type="password" class="w-full bg-white/5 border border-white/20 text-white rounded-xl px-4 py-3 focus:outline-none focus:border-blue-400 text-sm" placeholder="********">
                    </div>
                    <div id="confirm-pass-container" class="hidden">
                        <label class="text-blue-200 text-xs block mb-1">تأكيد كلمة المرور</label>
                        <input id="confirm-pass-input" type="password" class="w-full bg-white/5 border border-white/20 text-white rounded-xl px-4 py-3 focus:outline-none focus:border-blue-400 text-sm" placeholder="********">
                    </div>
                    <p id="error-msg" class="text-red-400 text-xs text-center hidden"></p>
                    <button onclick="handleAuthAction()" id="btn-auth-action" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-blue-500 transition">تسجيل الدخول</button>
                </div>
                <div class="flex items-center gap-2 text-blue-300 text-xs">
                    <div class="flex-1 h-[1px] bg-white/20"></div><span>أو</span><div class="flex-1 h-[1px] bg-white/20"></div>
                </div>
                <button onclick="handleGoogleLogin()" class="w-full bg-white text-gray-700 py-3 rounded-xl font-bold shadow-md hover:bg-gray-100 transition flex items-center justify-center gap-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 19"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span>Continue with Google</span>
                </button>
                <div id="toggle-auth-mode" class="text-center text-sm text-gray-400 mt-4 cursor-pointer hover:text-blue-300">
                    ليس لديك حساب؟ <span class="font-bold text-blue-400">إنشاء حساب جديد</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. شاشة إعداد الصلاحيات (Native Setup) -->
    <div id="screen-permissions" class="fixed inset-0 z-30 hidden flex-col items-center justify-center bg-[#0F172A] p-6">
        <div class="w-full max-w-sm text-center">
            <div class="w-16 h-16 mx-auto bg-blue-600 rounded-full flex items-center justify-center mb-4 shadow-lg">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
            </div>
            <h2 class="text-2xl text-white font-bold mb-2">إعداد صلاحيات النظام</h2>
            <p class="text-gray-400 text-sm mb-6">لعمل التطبيق بكفاءة، يرجى تفعيل الخدمات التالية:</p>

            <div class="space-y-3 text-right mb-6">
                <!-- زر Accessibility -->
                <div class="card-dark rounded-xl p-3 flex items-center justify-between">
                    <div>
                        <h3 class="text-white font-bold text-sm">خدمة الوصول (Accessibility)</h3>
                        <p class="text-gray-500 text-xs">مطلوبة لمراقبة التطبيقات</p>
                    </div>
                    <button onclick="requestAccessibility()" class="px-3 py-1 bg-slate-700 text-white text-xs rounded-lg border border-slate-600 hover:bg-slate-600">تفعيل</button>
                </div>
                
                <!-- زر Location -->
                <div class="card-dark rounded-xl p-3 flex items-center justify-between">
                    <div>
                        <h3 class="text-white font-bold text-sm">خدمة الموقع (Location)</h3>
                        <p class="text-gray-500 text-xs">مطلوبة لتتبع الموقع</p>
                    </div>
                    <button onclick="requestLocation()" class="px-3 py-1 bg-slate-700 text-white text-xs rounded-lg border border-slate-600 hover:bg-slate-600">تفعيل</button>
                </div>

                 <!-- زر Overlay -->
                 <div class="card-dark rounded-xl p-3 flex items-center justify-between">
                    <div>
                        <h3 class="text-white font-bold text-sm">الظهور فوق التطبيقات</h3>
                        <p class="text-gray-500 text-xs">لعرض التنبيهات</p>
                    </div>
                    <button onclick="requestOverlay()" class="px-3 py-1 bg-slate-700 text-white text-xs rounded-lg border border-slate-600 hover:bg-slate-600">تفعيل</button>
                </div>
            </div>

            <button onclick="finishPermissions()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-green-500 transition">متابعة للربط</button>
        </div>
    </div>

    <!-- 4. شاشة الشروط -->
    <div id="screen-terms" class="fixed inset-0 z-20 hidden flex-col items-center justify-center bg-[#0F172A] p-6">
        <div class="w-full max-w-sm text-center">
            <h2 class="text-2xl text-white font-bold mb-2">الشروط والأحكام</h2>
            <p class="text-gray-400 text-sm mb-6 leading-relaxed">يتيح لك هذا التطبيق مراقبة نشاط الطفل لحمايته من المحتوى الضار. بمتابعتك فإنك توافق على الالتزام بالقوانين المحلية.</p>
            <button onclick="acceptTerms()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-blue-500 transition mb-3">موافق</button>
            <button onclick="rejectTerms()" class="w-full bg-transparent text-gray-400 py-2 font-medium text-sm hover:text-white transition">رفض</button>
        </div>
    </div>

    <!-- 5. شاشة الربط -->
    <div id="screen-binding" class="fixed inset-0 z-10 hidden flex-col items-center justify-center bg-[#0F172A] p-6">
        <div class="w-full max-w-sm text-center">
            <h2 class="text-2xl text-white font-bold mb-2">اربط جهاز الطفل</h2>
            <p class="text-gray-400 text-sm mb-6">امسح الكود أو أدخل الرقم في تطبيق الطفل</p>
            <div class="bg-white p-4 rounded-2xl inline-block mb-4 shadow-lg">
                <div class="w-48 h-48 bg-gray-200 flex items-center justify-center text-gray-400 text-xs">QR CODE</div>
            </div>
            <div class="bg-slate-800 border-2 border-dashed border-blue-500 rounded-xl p-4 mb-6">
                <p class="text-gray-400 text-xs mb-1">كود الربط اليدوي</p>
                <p id="binding-code-display" class="text-3xl font-mono tracking-widest text-white font-bold">280 687 904</p>
            </div>
            <button onclick="checkBinding()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-green-500 transition">التحقق من حالة الربط</button>
        </div>
    </div>

    <!-- 6. الواجهة الرئيسية -->
    <div id="screen-main" class="hidden fixed inset-0 bg-[#0F172A] flex flex-col overflow-hidden">
        <header class="bg-slate-900/90 backdrop-blur-lg border-b border-slate-700 px-4 py-3 flex justify-between items-center z-20 shrink-0">
            <h1 class="text-xl font-bold text-white tracking-wide">Abu <span class="golden-text-title">Al-Zahra</span></h1>
            <div class="flex items-center gap-2">
                <span class="text-xs text-green-400 bg-green-500/10 px-2 py-1 rounded-full">متصل</span>
                <button onclick="openModal('modal-account')" class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-gray-300 text-xs font-bold">A</button>
            </div>
        </header>
        <main class="flex-1 overflow-y-auto pb-20 pt-4 px-4">
            <!-- Device Info -->
            <div class="card-dark rounded-2xl p-4 mb-4 flex items-center gap-4">
                <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-lg">S</div>
                <div class="flex-1">
                    <h2 class="font-bold text-white">Samsung SM-N960U</h2>
                    <div class="flex items-center gap-2 text-gray-400 text-xs"><span>85%</span> | <span>WiFi</span> | <span>الرياض</span></div>
                </div>
            </div>
            <!-- Map -->
            <div class="rounded-2xl overflow-hidden relative h-32 card-dark border border-slate-700 mb-6">
                <img src="https://placehold.co/800x300/1e293b/64748b?text=Live+Location" class="w-full h-full object-cover opacity-60">
            </div>
            <!-- Tools -->
            <h3 class="text-gray-400 text-xs font-bold tracking-wider mb-3">أدوات الوصول الحي</h3>
            <div class="grid grid-cols-3 gap-3 mb-6">
                 <button onclick="showFeature('بث الشاشة', '...')" class="card-dark rounded-xl p-3 flex flex-col items-center justify-center h-24 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-red-500/20 rounded-full flex items-center justify-center mb-1"><svg class="w-5 h-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg></div><span class="text-[10px] font-bold text-gray-200">بث الشاشة</span></button>
                 <button onclick="showFeature('الكاميرا', '...')" class="card-dark rounded-xl p-3 flex flex-col items-center justify-center h-24 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center mb-1"><svg class="w-5 h-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /></svg></div><span class="text-[10px] font-bold text-gray-200">الكاميرا</span></button>
                 <button onclick="showFeature('الاستماع', '...')" class="card-dark rounded-xl p-3 flex flex-col items-center justify-center h-24 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-purple-500/20 rounded-full flex items-center justify-center mb-1"><svg class="w-5 h-5 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg></div><span class="text-[10px] font-bold text-gray-200">الاستماع</span></button>
            </div>
            <!-- Messaging Tools -->
            <h3 class="text-gray-400 text-xs font-bold tracking-wider mb-3">أدوات المراسلة والسجلات</h3>
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="openModal('modal-whatsapp')" class="card-dark rounded-xl p-4 flex items-center gap-3 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center text-white text-sm font-bold">W</div><span class="text-sm font-bold text-white">واتساب</span></button>
                <button onclick="openModal('modal-messenger')" class="card-dark rounded-xl p-4 flex items-center gap-3 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center text-white text-sm font-bold">M</div><span class="text-sm font-bold text-white">ماسنجر</span></button>
                <button onclick="openModal('modal-sms')" class="card-dark rounded-xl p-4 flex items-center gap-3 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-slate-600 rounded-lg flex items-center justify-center text-white text-sm font-bold">S</div><span class="text-sm font-bold text-white">SMS</span></button>
                <button onclick="openModal('modal-notifications')" class="card-dark rounded-xl p-4 flex items-center gap-3 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center text-white text-sm font-bold">N</div><span class="text-sm font-bold text-white">الإشعارات</span></button>
                <button onclick="openModal('modal-calls')" class="card-dark rounded-xl p-4 flex items-center gap-3 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center text-white text-sm font-bold">C</div><span class="text-sm font-bold text-white">المكالمات</span></button>
                <button onclick="openModal('modal-apps')" class="card-dark rounded-xl p-4 flex items-center gap-3 hover:bg-slate-700 transition"><div class="w-10 h-10 bg-pink-500 rounded-lg flex items-center justify-center text-white text-sm font-bold">A</div><span class="text-sm font-bold text-white">التطبيقات</span></button>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-sms" class="modal-overlay" onclick="closeModal('modal-sms')"><div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h2 class="text-lg font-bold text-white">الرسائل النصية</h2><button onclick="closeModal('modal-sms')" class="text-gray-400 hover:text-white text-2xl">&times;</button></div><div class="modal-body text-center"><p class="text-gray-500">لا توجد رسائل جديدة.</p></div></div></div>
    <div id="modal-messenger" class="modal-overlay" onclick="closeModal('modal-messenger')"><div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h2 class="text-lg font-bold text-white">ماسنجر</h2><button onclick="closeModal('modal-messenger')" class="text-gray-400 hover:text-white text-2xl">&times;</button></div><div class="modal-body text-center"><p class="text-gray-500">لا توجد رسائل جديدة.</p></div></div></div>
    <div id="modal-whatsapp" class="modal-overlay" onclick="closeModal('modal-whatsapp')"><div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h2 class="text-lg font-bold text-white">واتساب</h2><button onclick="closeModal('modal-whatsapp')" class="text-gray-400 hover:text-white text-2xl">&times;</button></div><div class="modal-body text-center"><p class="text-gray-500">لا توجد رسائل جديدة.</p></div></div></div>
    <div id="modal-notifications" class="modal-overlay" onclick="closeModal('modal-notifications')"><div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h2 class="text-lg font-bold text-white">الإشعارات</h2><button onclick="closeModal('modal-notifications')" class="text-gray-400 hover:text-white text-2xl">&times;</button></div><div class="modal-body text-center"><p class="text-gray-500">لا توجد إشعارات.</p></div></div></div>
    <div id="modal-calls" class="modal-overlay" onclick="closeModal('modal-calls')"><div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h2 class="text-lg font-bold text-white">المكالمات</h2><button onclick="closeModal('modal-calls')" class="text-gray-400 hover:text-white text-2xl">&times;</button></div><div class="modal-body text-center"><p class="text-gray-500">لا يوجد سجل مكالمات.</p></div></div></div>
    <div id="modal-apps" class="modal-overlay" onclick="closeModal('modal-apps')"><div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h2 class="text-lg font-bold text-white">التطبيقات</h2><button onclick="closeModal('modal-apps')" class="text-gray-400 hover:text-white text-2xl">&times;</button></div><div class="modal-body text-center"><p class="text-gray-500">لم يتم مزامنة التطبيقات بعد.</p></div></div></div>
    <div id="modal-feature" class="modal-overlay" onclick="closeModal('modal-feature')"><div class="modal-content" style="height:auto; width:300px;" onclick="event.stopPropagation()"><div class="p-6 text-center"><h2 id="feature-title" class="text-lg font-bold text-white mb-2"></h2><p id="feature-body" class="text-gray-400 text-sm"></p><button onclick="closeModal('modal-feature')" class="mt-4 bg-slate-700 text-white px-4 py-2 rounded-lg text-sm">إغلاق</button></div></div></div>
    
    <div id="modal-account" class="modal-overlay" onclick="closeModal('modal-account')">
        <div class="modal-content" style="height:auto;" onclick="event.stopPropagation()">
            <div class="p-6 text-center">
                <h2 class="text-lg font-bold text-white mb-4">إدارة الحساب</h2>
                <p id="user-email-display" class="text-gray-400 text-sm mb-4">البريد الإلكتروني</p>
                <button onclick="handleLogout()" class="w-full bg-red-600 text-white py-2 rounded-lg text-sm">تسجيل الخروج</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB_05675Ywe_FH6lSDog1k991ARCDNFmK4",
            authDomain: "studio-7073076148-6afe0.firebaseapp.com",
            projectId: "studio-7073076148-6afe0",
            storageBucket: "studio-7073076148-6afe0.firebasestorage.app",
            messagingSenderId: "787676787951",
            appId: "1:787676787951:web:affa3703054f22fd94171a",
            databaseURL: "https://studio-7073076148-6afe0-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let isLoginMode = true;

        // --- Native Bridge (Kotlin Connection) ---
        function callNative(functionName, arg) {
            if (typeof AndroidNative !== 'undefined') {
                if (arg) AndroidNative[functionName](arg);
                else AndroidNative[functionName]();
            } else {
                console.log(`Native call (${functionName}) not available in browser.`);
            }
        }

        window.requestAccessibility = () => { callNative('openAccessibilitySettings'); }
        window.requestLocation = () => { callNative('openLocationSettings'); }
        window.requestOverlay = () => { callNative('openOverlaySettings'); } // You need to add this to Kotlin file if needed
        
        // --- UI Logic ---
        function showScreen(id) {
            document.querySelectorAll('[id^="screen-"]').forEach(el => { el.classList.add('hidden'); el.classList.remove('flex'); });
            document.getElementById(id).classList.remove('hidden');
            document.getElementById(id).classList.add('flex');
        }

        window.openModal = (id) => { document.getElementById(id).style.display = 'flex'; }
        window.closeModal = (id) => { document.getElementById(id).style.display = 'none'; }
        window.showFeature = (t, b) => { document.getElementById('feature-title').innerText = t; document.getElementById('feature-body').innerText = b; openModal('modal-feature'); }

        // --- Auth Logic ---
        window.toggleAuthMode = () => {
            const title = document.getElementById('auth-subtitle');
            const btn = document.getElementById('btn-auth-action');
            const confirmContainer = document.getElementById('confirm-pass-container');
            const toggleDiv = document.getElementById('toggle-auth-mode');
            const errorP = document.getElementById('error-msg');

            isLoginMode = !isLoginMode;
            errorP.classList.add('hidden');

            if (isLoginMode) {
                title.innerText = "تسجيل الدخول للمتابعة";
                btn.innerText = "تسجيل الدخول";
                confirmContainer.classList.add('hidden');
                toggleDiv.innerHTML = 'ليس لديك حساب؟ <span class="font-bold text-blue-400">إنشاء حساب جديد</span>';
            } else {
                title.innerText = "إنشاء حساب جديد";
                btn.innerText = "إنشاء حساب";
                confirmContainer.classList.remove('hidden');
                toggleDiv.innerHTML = 'لديك حساب بالفعل؟ <span class="font-bold text-blue-400">تسجيل الدخول</span>';
            }
        }
        document.getElementById('toggle-auth-mode').addEventListener('click', toggleAuthMode);

        window.handleAuthAction = () => {
            const email = document.getElementById('email-input').value;
            const pass = document.getElementById('pass-input').value;
            const confirmPass = document.getElementById('confirm-pass-input').value;
            const errorP = document.getElementById('error-msg');

            if (!email || !pass) { errorP.innerText = "جميع الحقول مطلوبة"; errorP.classList.remove('hidden'); return; }

            if (isLoginMode) {
                signInWithEmailAndPassword(auth, email, pass).catch((error) => { errorP.innerText = "بيانات الدخول غير صحيحة"; errorP.classList.remove('hidden'); });
            } else {
                if (pass !== confirmPass) { errorP.innerText = "كلمتا المرور غير متطابقتين"; errorP.classList.remove('hidden'); return; }
                createUserWithEmailAndPassword(auth, email, pass).catch((error) => { errorP.innerText = "البريد مستخدم مسبقاً"; errorP.classList.remove('hidden'); });
            }
        }

        window.handleGoogleLogin = () => { signInWithPopup(auth, provider); }

        onAuthStateChanged(auth, (user) => {
            document.getElementById('screen-splash').classList.add('hidden');
            if (user) {
                document.getElementById('user-email-display').innerText = user.email;
                const permissionsGranted = localStorage.getItem('permissionsGranted');
                if (permissionsGranted !== 'true') {
                    showScreen('screen-permissions');
                } else {
                    const termsAccepted = localStorage.getItem('termsAccepted');
                    if (termsAccepted === 'true') showScreen('screen-binding');
                    else showScreen('screen-terms');
                }
            } else { showScreen('screen-login'); }
        });

        window.finishPermissions = () => {
            localStorage.setItem('permissionsGranted', 'true');
            showScreen('screen-terms');
        }

        window.acceptTerms = () => { localStorage.setItem('termsAccepted', 'true'); showScreen('screen-binding'); }
        window.rejectTerms = () => { handleLogout(); }
        window.handleLogout = () => { signOut(auth).then(() => { closeModal('modal-account'); localStorage.clear(); showScreen('screen-login'); }); }
        window.checkBinding = () => { document.querySelector('#screen-binding button').innerText = "جاري البحث..."; setTimeout(() => { showScreen('screen-main'); }, 2000); }
    </script>
</body>
</html>
